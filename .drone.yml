pipeline:
    telegram-notify-start-build:
        image: appleboy/drone-telegram
        secrets:
          - telegram_token
        to: 
         - 57439615
        format: markdown
        message: >
            üïí –ù–∞—á–∏–Ω–∞–µ–º —Å–æ–±–∏—Ä–∞—Ç—å `{{repo.name}} - {{commit.branch}} rev.{{build.number}}`.

            –ê–≤—Ç–æ—Ä - {{commit.author}}.
            
            –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∏–∂–µ. –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–º–º–∏—Ç - [–ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è](https://gogs.squizduos.ru/squizduos/img-test/commit/{{commit.sha}})
            
            `{{commit.message}}`
        when:
            branch: master

    build:
        image: docker/compose:1.9.0
        commands:
         - docker-compose build
        volumes:
          - /var/run/docker.sock:/var/run/docker.sock
        when:
            branch: master
    
    telegram-notify-start-deploy:
        image: appleboy/drone-telegram
        secrets:
          - telegram_token
        to: 
         - 57439615
        format: markdown
        message: >
            {{#success build.status}}
            ‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ! –ó–∞–ª–∏–≤–∫–∞!**
            
            –í –±–ª–∏–∂–∞–π—à–∏–µ 20 —Å–µ–∫—É–Ω–¥ —Å–µ—Ä–≤–∏—Å [img-test](http://img-test.squizduos.ru) –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–∏–Ω–æ—Å–∏–º —Å–≤–æ–∏ –∏–∑–≤–∏–Ω–µ–Ω–∏—è.
            {{else}}
            ‚ùå –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ `{{repo.name}} - {{commit.branch}} rev.{{build.number}}` –Ω–µ —É–¥–∞–ª–∞—Å—å.

            –í–∏–Ω–æ–≤–Ω–∏–∫ —Ç–æ—Ä–∂–µ—Å—Ç–≤–∞ - {{commit.author}}. –ö–æ–º–º–∏—Ç [–ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è](https://gogs.squizduos.ru/squizduos/img-test/commit/{{commit.sha}}).

            –î–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ [—Å—Å—ã–ª–∫–µ]({{build.link}}). 

            –°–µ—Ä–≤–∏—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø–æ –∞–¥—Ä–µ—Å—É [http://img-test.squizduos.ru](http://img-test.squizduos.ru).
            {{/success}}
        when:
            branch: master
            status:  [ success ]

    deploy-local:
        image: docker/compose:1.9.0
        commands:
          - docker-compose up -d
        volumes:
          - /var/run/docker.sock:/var/run/docker.sock
        when:
            branch: master
            status:  [ success ]
    
    telegram-notify-deploy-finished:
        image: appleboy/drone-telegram
        secrets:
          - telegram_token
        to: 
         - 57439615
        format: markdown
        message: >
            {{#success build.status}}
            –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ `{{repo.name}} - {{commit.branch}} rev.{{build.number}}` —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

            –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —à–ª–∞ —Å {{datetime build.started "15:04:05" "GMT+3"}} –ø–æ {{datetime build.finished "15:04:05" "GMT+3"}} {{datetime build.finished "01.02.2006" "GMT+3"}} –≥.
            
            –î–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ [—Å—Å—ã–ª–∫–µ]({{build.link}}).

            –°–µ—Ä–≤–∏—Å –≤–æ–∑–æ–±–Ω–æ–≤–∏–ª —Å–≤–æ—é —Ä–∞–±–æ—Ç—É –Ω–∞ [http://img-test.squizduos.ru](http://img-test.squizduos.ru).
            {{else}}
            ‚ùå **–í–ù–ò–ú–ê–ù–ò–ï! –í–ù–ò–ú–ê–ù–ò–ï!**

            –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–µ—É–¥–∞—á–Ω–∞—è! –°–µ—Ä–≤–∏—Å [http://img-test.squizduos.ru](http://img-test.squizduos.ru) –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

            –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–æ–æ–±—â–∏—Ç–µ @squizduos.
            {{/success}}
        when:
            branch: master
            status:  [ failure, success ]

