kind: pipeline
name: default

steps:
- name: telegram-notify-start-build
  image: appleboy/drone-telegram
  settings:
    token: 475550485:AAEPwrdG__WucKhO41aUi2J1ivu78cOu0nk
    to: 57439615
    format: markdown
    message: >
        üïí –ù–∞—á–∏–Ω–∞–µ–º —Å–æ–±–∏—Ä–∞—Ç—å `{{repo.name}} - {{commit.branch}} rev.{{build.number}}`.


        –ê–≤—Ç–æ—Ä - {{commit.author}}.


        –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—â–µ–Ω –ø–æ [—Å—Å—ã–ª–∫–µ](https://{{commit.branch}}.{{repo.name}}.squizduos.ru)


        –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∏–∂–µ. –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–º–º–∏—Ç [–ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è](https://gogs.squizduos.ru/squizduos/{repo.name}/commit/{{commit.sha}}).


        `{{commit.message}}`

- name: build
  image: docker/compose:1.23.2
  commands:
  - docker-compose -p ${DRONE_REPO_NAME}-${DRONE_COMMIT_BRANCH} build
  volumes:
  - name: dockersock
    path: /var/run/docker.sock
  when:
    status:
    - success

#- name: telegram-notify-start-deploy
#  image: appleboy/drone-telegram
#  settings:
#    token: 475550485:AAEPwrdG__WucKhO41aUi2J1ivu78cOu0nk
#    to: 57439615
#    format: markdown
#    message: >
#        {{#success build.status}}
#        ‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ! –ó–∞–ª–∏–≤–∫–∞!**
#
#
#        –í –±–ª–∏–∂–∞–π—à–∏–µ 20 —Å–µ–∫—É–Ω–¥ —Å–µ—Ä–≤–∏—Å [{{commit.branch}}/{{repo.name}}](https://{{commit.branch}}.{{repo.name}}.squizduos.ru) –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–∏–Ω–æ—Å–∏–º —Å–≤–æ–∏ –∏–∑–≤–∏–Ω–µ–Ω–∏—è.
#        {{else}}
#        ‚ùå –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ `{{repo.name}} - {{commit.branch}} rev.{{build.number}}` –Ω–µ —É–¥–∞–ª–∞—Å—å.
#
#
#        –í–∏–Ω–æ–≤–Ω–∏–∫ —Ç–æ—Ä–∂–µ—Å—Ç–≤–∞ - {{commit.author}}. –ö–æ–º–º–∏—Ç [–ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è](https://gogs.squizduos.ru/squizduos/{{repo.name}}/commit/{{commit.sha}}).
#
#
#        –î–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ [—Å—Å—ã–ª–∫–µ]({{build.link}}).
#
#
#        –°–µ—Ä–≤–∏—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø–æ –∞–¥—Ä–µ—Å—É [https://{{commit.branch}}.{{repo.name}}.squizduos.ru](https://{{commit.branch}}.{{repo.name}}.squizduos.ru).
#        {{/success}}
#  when:
#    status:
#    - success
#
#- name: deploy-local
#  image: docker/compose
#  commands:
#  - set -a
#  - export BRANCH=${DRONE_COMMIT_BRANCH}
#  - docker-compose -p ${DRONE_REPO_NAME}-${DRONE_COMMIT_BRANCH} up -d
#  volumes:
#  - name: dockersock
#    path: /var/run/docker.sock
#  when:
#    status:
#    - success
#
#- name: telegram-notify-deploy-finished
#  image: appleboy/drone-telegram
#  settings:
#    token: 475550485:AAEPwrdG__WucKhO41aUi2J1ivu78cOu0nk
#    to: 57439615
#    format: markdown
#    message: >
#        {{#success build.status}}
#        üëå –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ `{{repo.name}} - {{commit.branch}} rev.{{build.number}}` —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.
#
#
#        –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —à–ª–∞ —Å {{datetime build.started "15:04:05" "GMT+3"}} –ø–æ {{datetime build.finished "15:04:05" "GMT+3"}} {{datetime build.finished "02.01.2006" "GMT+3"}} –≥.
#
#
#        –î–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ [—Å—Å—ã–ª–∫–µ]({{build.link}}).
#
#
#        –°–µ—Ä–≤–∏—Å –≤–æ–∑–æ–±–Ω–æ–≤–∏–ª —Å–≤–æ—é —Ä–∞–±–æ—Ç—É –Ω–∞ [(https://{{commit.branch}}.{{repo.name}}.squizduos.ru]((https://{{commit.branch}}.{{repo.name}}.squizduos.ru).
#        {{else}}
#        ‚ùå **–í–ù–ò–ú–ê–ù–ò–ï! –í–ù–ò–ú–ê–ù–ò–ï!**
#
#
#        –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–µ—É–¥–∞—á–Ω–∞—è! –°–µ—Ä–≤–∏—Å [(https://{{commit.branch}}.{{repo.name}}.squizduos.ru]((https://{{commit.branch}}.{{repo.name}}.squizduos.ru) –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.
#
#
#        –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–æ–æ–±—â–∏—Ç–µ @squizduos.
#        {{/success}}
#    when:
#    status:
#    - success
#    - failure

volumes:
- name: dockersock
  host:
    path: /var/run/docker.sock
